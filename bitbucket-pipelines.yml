image: node:lts

pipelines:
    default:
        -   step:
                name: Build and Test
                script:
                    - npm install
                    - npm test
        -   step:
                name: Publish
                deployment: production
                script:
                    - npm version patch -m "Upgrade to %s [skip ci]"
                    - git push && git push --tags
                    -   pipe: atlassian/npm-publish:1.1.0
                        variables:
                            NPM_TOKEN: $NPM_TOKEN
                            EXTRA_ARGS: "--access public"
